---
title: "XXXXX"
author:
- Xiao Bai
- Yichun Zhang
date: "10/04/2022"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
  html_document:
    toc: yes
    toc_depth: '2'
    df_print: paged
subtitle: "XXXXXXXXXXXXX"
abstract: "XXXXXXXXXXXXXXXX"
bibliography: references.bib
---

```{r setup_lib, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
#install.packages("devtools")
#devtools::install_github("warint/statcanR")
#install.packages("gridExtra")
library(tidyverse)
library(dplyr)
library(openintro)
library(janitor)
library(lubridate)
library(gridExtra)
library(grid)

```

# Introduction 

Apartment houses are deviations from the North American ideal of single-family, owner-occupied dwellings. Understandably, they drew a lot of flak once they were initially built in Canadian cities, particularly in Toronto, where anti-apartment laws were passed in 1912. They were decried as unsanitary, anti-family, and a danger to established property values, damaging both morally and economically "cities of houses." They were, nevertheless, indications of modernism and international elegance, commended for their efficiency and suitability for new sorts of homes living new lives. As a result, they appeared in new communities in the Canadian West, particularly in the 1910s, and grew in popularity during the 1920s. The Toronto launched the enforcement program in 2017 to ensure that apartments adhere building upkeep regulations. Every year, the City compiles a list of all buildings that require an evaluation that year. A Bylaw Enforcement Officer is assigned for each building evaluation and building owner/operators are notified when their building requires an evaluation. The evaluation is scheduled so that the property owner, or a designate can be present to provide the bylaw enforcement officer access to locked common areas and/or facility amenities.

The apartment safety score is one of the most critical indicators to help us choose an apartment. On the other hand, the value of real estate is enormous, and apartment security is directly reflected in the value of the apartment. At the same time, Toronto's apartments are mainly concentrated in densely populated areas like the city center. Since the apartment has a long service life as a residence, the safety of the apartment is likely to be affected by various factors within the service life. Due to the scattered households and asymmetry of information, ensuring the safety of apartments requires reasonable supervision by the government. The government needs to understand the specific influencing factors of apartment safety to regulate the property better, set standards, and timely supervise and punish them. Therefore, an in-depth understanding of the factors that influence apartment security in Toronto can help the government determine the importance of different factors, thereby achieving differentiated management. The government can revise the detailed rules of apartment building evaluation standards in the future based on the size of the impact on apartment safety to more efficiently protect the safety of residents.

Some key variables of this paper are: score, confirmed units, confirmed storeys, entrance lobby and etc. Score is a number between 0 to 100 that shows how well the apartment is maintained. In this paper, we first take a glance of what this data is like by drawing some graphs and create some tables.We also built a shiny application that _____________. With the basic idea of this data is like in mind, we implemented confidence interval analysis that studies the mean and standard deviation of scores.The result shows that we are 95% confident that the true mean is between 71.95 and 72.37 and we are 95% confident that the true sample standard deviation is between 10.06058 and 10.51280. The "95%" in the confidence interval above indicates the degree of conviction we have about our estimate. If we repeated the method (drawing a new sample, conducting new interviews, computing fresh estimates and confidence intervals), the confidence intervals would almost always include the average of all the estimates. As a consequence, we have generated a single estimate in such a manner that, if repeated endlessly, 90% of the confidence intervals obtained include the correct value. Confidence intervals are one approach to quantify the "quality" of an estimate; the bigger the 95% confidence interval for a given estimate, the more care is necessary when utilising the estimate. Confidence intervals serve as a crucial reminder of the estimates' limitations.<https://www.census.gov/programs-surveys/saipe/guidance/confidence-intervals.html>

Afterward, we are interested in how the 

2)some detail about what the paper is about; 3) a clear gap that needs to be filled; 4) what was done; 5) what was found; and 6) why it is important. 

# Data 

The data is from Toronto's open data. A bylaw enforcement program launched in 2017 to ensure that apartment building owners and operators with three or more levels of units or ten or more units adhere to building upkeep regulations. This dataset comprises ratings for rental properties that have been registered with RentSafeTO. Buildings must be inspected at the very least once every three years, if not more often. Common spaces, mechanical and security systems, parking lots, and outdoor grounds are all evaluated by Bylaw Enforcement Officers throughout the course of their duties. A score of one to five is assigned to each item, with one being the lowest and five representing the highest. At the time of assessment, if an item is not relevant to the building, its score will be recorded as a blank in the dataset. Specifically, the dataset contain more information about registered apartments' number of storeys and units, the year they are evaluated, number of areas they are evaluated, their latitutes and longtitudes and their score. The score is between 0 to 100. 

For future usage, I constructed several different datasets for different uses. 

Did you construct any variables by combining various ones? What do the data look like?
After obtaining the data, I cleaned the data. 

```{r data_rent, include = FALSE}
library(opendatatoronto)
library(dplyr)

# get package
package <- show_package("4ef82789-e038-44ef-a478-a8f3590c3eb1")
package

# get all resources for this package
resources <- list_package_resources("4ef82789-e038-44ef-a478-a8f3590c3eb1")

# identify datastore resources; by default, Toronto Open Data sets datastore resource format to CSV for non-geospatial and GeoJSON for geospatial resources
datastore_resources <- filter(resources, tolower(format) %in% c('csv', 'geojson'))

# load the first datastore resource as a sample
data <- filter(datastore_resources, row_number()==1) %>% get_resource()
data
# Here you can load in and clean the data (you may need to do the cleaning in a separate R script). 

# You may need additional chunks, in case you want to include some of the cleaning output.

# Notice that the include=FALSE means that the code, and its resulting output, in this chunk will not appear in the pdf.
rent = data%>%mutate(id = c(1:nrow(data)),YEAR_BUILT = as.numeric(YEAR_BUILT),YEAR_EVALUATED = as.numeric(YEAR_EVALUATED), CONFIRMED_STOREYS = as.numeric(CONFIRMED_STOREYS),CONFIRMED_UNITS = as.numeric(CONFIRMED_UNITS),SCORE = as.numeric(SCORE),NO_OF_AREAS_EVALUATED = as.numeric(NO_OF_AREAS_EVALUATED),LATITUDE = as.numeric(LATITUDE),LONGITUDE = as.numeric(LONGITUDE),)%>%dplyr::select(id,YEAR_BUILT,YEAR_EVALUATED,PROPERTY_TYPE,CONFIRMED_STOREYS,CONFIRMED_UNITS,SCORE,NO_OF_AREAS_EVALUATED, LATITUDE,LONGITUDE)%>% mutate(Age_Evaluated = YEAR_EVALUATED - YEAR_BUILT)%>% na.omit()

## Create training and test set ##
set.seed(1)
n = nrow(rent)
train <- rent[sample(seq_len(n), size = round(n/2)),]
test <- rent[!rent$id %in% train$id,]
nrow(test)
nrow(train)
```

```{r overview_table, include = FALSE}
data = data %>% na.omit() %>% mutate(ENTRANCE_LOBBY = as.numeric(ENTRANCE_LOBBY), CONFIRMED_STOREYS = as.numeric(CONFIRMED_STOREYS), CONFIRMED_UNITS = as.numeric(CONFIRMED_UNITS), SCORE = as.numeric(SCORE), YEAR_BUILT = as.numeric(YEAR_BUILT), YEAR_EVALUATED = as.numeric(YEAR_EVALUATED))

data_clean = clean_names(data)
rent_clean = clean_names(rent)

table = data_clean %>% summarize(mean_year_build = mean(year_built), 
                         mean_year_evaluated = mean(year_evaluated), 
                         mean_confirmed_units = mean(confirmed_units), 
                         mean_confirmed_storeys = mean(confirmed_storeys), 
                         mean_score = mean(score))
```

```{r table_cont, include = FALSE}
#table2 = data_clean %>% summarize(year_build = median(year_built), 
 #                        year_evaluated = median(year_evaluated), 
  #                       confirmed_units = median(confirmed_units), 
  #                       confirmed_storeys = median(confirmed_storeys), 
  #                       score = median(score))
```

```{r table_cont_count, include = FALSE}
table3 = data_clean %>% summarize(year_build = sd(year_built), 
                         year_evaluated = sd(year_evaluated), 
                         confirmed_units = sd(confirmed_units), 
                         confirmed_storeys = sd(confirmed_storeys), 
                         score = sd(score))
```


|Table x|Year Built|Year Evaluated|Confirmed Units|Confirmed Storeys|Score|
|-------------|------------|----------------|------------------|---------------|---------|
|Mean|1961.072|2018.562|88.61429|7.608147|73.36976|
|Median | 1961 |2018|50|5|73|
|Standard Deviation|18.34138|1.467761|94.60839|6.052611|9.916641|

The above table shows the mean, median and standard deviation of key variables, and also brings a general idea of their distributions. The average built year of evaluated apartments is around 1961, and the evaluating year of these buildings are centered around 2018. The average confirmed units of these apartments are 88, while the median confirmed units of these buildings are 50. On the other hand, the mean confirmed storeys is 7.6 and the median confirmed number of storeys is 5. The standard deviation is a measure of the amount of values' variance or dispersion. A low standard deviation implies that values are often near to the set's mean, while a high standard deviation shows that values are scattered throughout a broader range.The standard deviation of year built is about 18, and the standard deviation of year of evaluation of these apartments is about 1.47. This means the built year of these apartments are spreads broadly around 1961 while the evaluating year of the buildings are closely distributed around 2018.


```{r histogram_rent_clean, echo=FALSE, message = FALSE, warnings = FALSE}


g1 <- ggplot(data = data_clean, aes(x = confirmed_storeys)) + geom_histogram(color = "blue", fill = "azure2") + labs(x = "Number of Confirmed Storeys", y = "")

g2 <- ggplot(data = data_clean, aes(x = score)) + geom_histogram(color = "blue", fill = "azure2") + labs(x = "Score", y = "")

g3 <- ggplot(data = data_clean, aes(x = entrance_lobby)) + geom_histogram(color = "blue", fill = "azure2") + labs(x = "Number of Entrance Lobby", y = "") 


g4 <- ggplot(data = data_clean, aes(x = confirmed_units)) + geom_histogram(color = "blue", fill = "azure2") + labs(x = "Number of Confirmed Units", y = "")

grid.arrange(g1,g2,g3,g4,nrow=2,top=textGrob("Figure 1: Histograms that shows the distribution of some keys"))
```

The graph contain 4 histogram that shows the distribution of some key variables. First, the number of confirmed storeys is mostly between 0 and 10. Some of the apartments have more than 10 storeys but less than 20 storeys, and only few apartments have more than 20 storeys. The distribution of score is generally normally distributed centered around 75. As for number of lobby entrance, most apartments have 3 to 4 entrances, and some of them have 2 entrances or 5 entrances. The distribution fo number of confirmed units of these apartments are right-skewed. Most apartments have 0 to 200 confirmed units.

```{r, echo=FALSE, message=FALSE}
rent_clean %>% 
  group_by(confirmed_units, property_type) %>% 
  ggplot(aes(confirmed_units, score, color = property_type)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(vars(property_type),
              scales = "free_y"
             )

#> `summarise()` has grouped output by 'line'. You can override
#> using the `.groups` argument.
```

There are 3 different property types: private, social housing and Toronto community housing (TCHC). After dividing them into property types, we want to see the relationship between confirmed units and their score. The scattorplots above have x-axis being number of confirmed units and the y-axis being their score, and they are grouped by property type. The graphs shows that there seems to have no relationship between apartments' confirmed units and their score. 

## Making a Shiny Application 
```{r more graphs}
library(shiny)

library(babynames)
library(tidyverse)

top_five_names_by_year <-
  babynames %>%
  group_by(year, sex) %>%
  arrange(desc(n)) %>%
  slice_head(n = 5)

top_five_names_by_year %>%
  ggplot(aes(x = n, fill = sex)) +
  geom_histogram(position = "dodge") +
  theme_minimal() +
  scale_fill_brewer(palette = "Set1") +
  labs(x = "Babies with that name",
       y = "Occurances",
       fill = "Sex")

# Define UI for application that draws a histogram
ui <- fluidPage(
  # Application title
  titlePanel("Count of names for five most popular names each year."),
  
  # Sidebar with a slider input for number of bins
  sidebarLayout(sidebarPanel(
    sliderInput(
      inputId = "number_of_bins",
      label = "Number of bins:",
      min = 1,
      max = 50,
      value = 30
    )
  ),
  
  # Show a plot of the generated distribution
  mainPanel(plotOutput("distPlot")))
)

# Define server logic required to draw a histogram
server <- function(input, output) {
  output$distPlot <- renderPlot({
    # Draw the histogram with the specified number of bins
    top_five_names_by_year %>%
      ggplot(aes(x = n, fill = sex)) +
      geom_histogram(position = "dodge", bins = input$number_of_bins) +
      theme_minimal() +
      scale_fill_brewer(palette = "Set1") +
      labs(x = "Babies with that name",
           y = "Occurances",
           fill = "Sex")
  })
}

# Run the application
shinyApp(ui = ui, server = server)
```


# Confidence Interval 
## Methods 

  Confidence intervals are a range of probable true parameter values. To put it another way, it provides an estimate of a collection of numbers that is likely to contain an unknown true parameter. True parameters may include true means, real standard deviations, and true proportions, amongst other things. 
  As previously stated, each confidence interval is connected with a percentage, referred to as a confidence level. This percentage indicates our confidence that the findings accurately reflect the underlying population parameter, based on the random sample. As I aim to account for 95% of probable outcomes, this indicates that 1-$\alpha$ equals 95%. Because the bootstrap sample distribution is normal, and a 95 percent signifies the centre 95 percent, we exclude the beginning 2.5 percent and the final 2.5 percent from our interval. The confidence level selected must be impregnable, consistent, and equitable. I chose a 95% confidence level in this research since the majority of planes are scheduled and follow a certain routine. Choosing a 95 percent seems reasonable since it covers the majority of scenarios while giving some room for deviation, considering the possibility of flight cancellations and delays. In this report, we'll take the variable "value" as a parameter and calculate the sample mean and standard deviation of its sample. By selecting using replacement, we get a random sample of the population. Bootstrap is a statistical technique that use random sampling with replacement to infer the sample distribution of a population. The term "resamples" refers to these repeated experiments. The empirical bootstrap is a sort of bootstrap that samples from the sampling distribution of an estimate without defining the data distribution. Therefore, if you know the family of distributions $F(\theta)$ (such as "Exponential," "Normal," or "Poisson") from which the data is collected but not the function's value, the parametric bootstrap is used to sample from the estimator's sampling distribution. Because we do not know the distribution of our initial data, we will employ empirical bootstrap in this investigation. Additionally, the z-distribution requires knowledge of the population standard deviation, while the t-distribution requires just the sample standard deviation. We will use the t distribution in our study since we do not know the real standard deviation. Additionally, since we do not know the real value of the parameter, we will use a sample estimator to estimate it. Nonetheless, each estimator is unique since each sample is unique (selected at random). In this scenario, the confidence interval may be used to calculate the frequency with which an interval contains the genuine population standard deviation.

  To compute the margin of error for a confidence interval, we need a critical value (the number of standard errors we add and subtract to get the margin of error we want). When the sample size is large enough or we know what is the population standard deviation, we can apply the critical values on the Z-distribution. However, when the sample size is small or with the unknown population standard deviation, we should then use the t-distribution to find critical values. In mathematical definition, the CI for $\mu$ is ($\bar{X}-t_{\alpha/2,n-1}*s/\sqrt{n}$, $\bar{X}+t_{\alpha/2,n-1}*s/\sqrt{n}$).

## Results 
The first method of calculating confidence interval is via critical values (not via bootstrapping) and is for a mean. Since we do not know the population variance $\sigma^2$ but we know the sample variance $s^2$, so we should use the t distribution $\bar{X}-t_{\alpha/2,n-1}*s/\sqrt{n}$ and $\bar{X}+t_{\alpha/2,n-1}*s/\sqrt{n}$to get the confidence interval.

```{r, include= FALSE}
set.seed(187)
summary_table = rent_clean %>% 
  summarise(mean = mean(score), sd = sd(score))
summary_table
```

```{r, include= FALSE}
qt(0.975, nrow(rent_clean)-1)
# 95% quantile2

summary_table$mean - qt(0.975, nrow(rent_clean)-1)*summary_table$sd/sqrt(nrow(rent_clean))

summary_table$mean + qt(0.975, nrow(rent_clean)-1)*summary_table$sd/sqrt(nrow(rent_clean))

```


|  Table 2  |  Mean   |  SD  |  CI |
|----------|---------|----------|---------|
|     |  72.16 |   10.29   |  (71.95, 72.37) |


We first calculate the sample mean ($\bar{X}$) and sample standard deviation ($s$) from the variable "VALUE" of our dataset. From the table 2, we can see that $\bar{X}$ is 72.16 while $s$ is 10.29. When applying those values into the formula, we can get our confidence interval is (71.95, 72.37). It means we are 95% confident that true mean is between 71.95 and 72.37 (refer to the table). This means that we are confidence that 95% of all apartments in Toronto are scored between 71.95 and 72.37. 

We also want to use the bootstrap method to study the confirmed units of Toronto's apartments, and it is for standard deviation. We will use bootstrap method to test our hypothesis, that is, the true standard deviation equals to the sample standard deviation. Specifically, our hypothesis is, in this case, is  $\hat{\sigma} - \bar{\sigma} = 0$.

```{r,include=FALSE}
# via bootstrapping method (Empirical Boostrap)
rent_clean %>% summarise(sd = sd(score)) %>% as.numeric()
```

This is the sample standard deviation that we get from our data, which is 10.28. 

```{r, echo= FALSE}
repetitions <- 1000
boot_sd <- rep(NA, repetitions)
for (i in 1:repetitions) {
sim_sd <- rent_clean %>% sample_n(nrow(rent_clean), replace = TRUE) %>% 
  summarise(sd = sd(confirmed_units)) %>% 
  as.numeric()
boot_sd[i] <- sim_sd
}
boot_sd <- tibble(sd = boot_sd)
boot_sd %>% 
  ggplot(aes(x = sd)) + geom_histogram(fill = "white", color = "black") +
  geom_vline(xintercept = quantile(boot_sd$sd, c(0.025,0.975 )), color = "red")+
  labs(title = "xxxxx")
```

```{r, echo= FALSE}
quantile(boot_sd$sd, c(0.025,0.975 ))
```

The process: 
  First, we choose sample size: the original size of sample the all the values in our study. Afterward, we resampled with replacement for 1000 times, and sum up all the results. We get a distribution of the sampling result. The distribution is shown in a histogram. The distribution is often normal distribution, since we are just sampled randomly with replacement using our original data. Given that our prefered confidence level is 95%, we can find the confidence interval. Values between the 2 red lines are in the 95% interval. 1 minus first 2.5% and last 2.5% are the 95% range, so we use a quantile of 0.025 and 0.975 to see the value of bound. The result is : 
  We are 95% confident that true standard deviation is between 10.06058 and 0.51280 (refer to the table). 

By exploring our data, the sample mean of score is 72.16, and the sample standard deviation is 10.29. We hypothesize that the true standard deviation equals our sample standard deviation. Applying two methods (critical value  &bootstrap) to calculate the confidence interval, we have the following key results: 

  1. We are 95% confident that the true mean is between 71.95 and 72.37. 
  2. We are 95% confident that the true sample standard deviation is between 10.06058 and 10.51280.

   Overall, this data is just one year of the world database. Studying this dataset can give us some sense of the big picture of all Canada flight, while we do also need to expand and elaborate on our study to obtain a more scientific result. The work we’ve done can be useful for future studies. For example, the bootstrap method we used this time can be when we need to estimate a parameter, while we do not have the whole population we need as a sample. Using bootstrap, though this cannot give a certain number, we can find a range of where the parameter can be at. 

  
  To sum up, we focus on using the critical value and bootstrap method to explore aspects of aircraft movement data. First, we generally introduce the data and the background. Also, we give definitions for terminologies. Next step, we introduce the data we use and why we choose to use the specific variable. A histogram and a table are made here to define more about the data. Then we use two different methods “critical value” and “bootstrap,” to find the true mean and true standard deviation and know that we are 95% confident that the true mean between 28450.74 and 33097.48. We are 95% confident that the true sample standard deviation is between 7748.196 and 10230.532.

# Multiple Linear Regression 
## Methods

The multiple linear regression (MLR) are used to study the relations between many variables in th form: 

$$y = \beta_0 + \beta_1x_1 + ...+ \beta_px_p+ \epsilon$$
Where $\beta_i$ represents the coefficients need to estiamted, $x_i, i = 1...p$ is the predictor variables, y is the response variable, $\epsilon$ is the error term. 

The assumptions on $\epsilon$ are : 
1. $E(\epsilon) = 0$
2. $V(\epsilon) = \sigma^2I$
3. $\epsilon$ follow normal distribution. 

Under these assumptions, we can get a best linear unbiased estimate (BLUE) by the ordinary least square method. 

The dataset has 9688 observations and 40 variables, within which some variables record the score for each area. I want to estimate the overall rating of the apartments. Thus, I dropped these variables, and kept 9636 observations and eight variables. I split the dataset randomly by 50/50 to the train and test dataset. Their summaries are shown in Table X. The average built year is 1961, and the mean evaluated age is around 60 years. Due to the old age of these buildings, safety issue becomes more crucial. 

If a dataset has p predictors, there would be $2^p$ subset of the predictors in the regression analysis. Thus, when dealing with the dataset will a number of variables, we need to resort to automated selection methods to get a preferred model. Before this procedure, we can use the partial F test to eliminate some variables if we think these variables are unrelated to the research question. There are four measures used as the criteria for selecting models, which are Adjusted $R^2$, Akaike's Information Criterion (AIC), corrected AIC and BIC. In general, we prefer to select a model with a high adjusted $R^2$ while having a small AIC, AICc and BIC. However, sometimes, different models will get by these measures. Thus, the guideline to help us select the model as the best one if it has an adjusted $R^2$ that is slightly smaller but has one of the smallest values of AIC, AICc or BIC and fewer predictors. 

The most often used stepwise selection approach is forward/backward model selection. Forward model selection starts with no predictors and gradually adds them, while backward elimination begins with all predictors and gradually deletes them. The automated selection approach enables us to pick a model from a wide range of predictors in a systematic manner. However, owing to its one-direction action, we may not get the optimal model.

To validate a model, we must choose an independent dataset from the same population as the train dataset and see if the model performs similarly on the new dataset. The supplied dataset may be divided into two parts: the train and test datasets. The amount by which the dataset is divided is arbitrary, however 50/50 is the most typical split.

Occasionally, we are unable to verify our model. Several possible reasons for not validating the model include the following: 1) the test dataset is distinct from the training dataset; 2) the model has an excessive number of influential points. 3) a short test dataset; 4) a transformation relevant to correcting the model assumption. Thus, prior to the model validation phase, we must compare the distribution of variables in the test dataset.

Each time we alter the model, we must test the assumptions made throughout the variable selection phase. However, it will take an inordinate amount of time. Rather than that, we may sometimes evaluate assumptions using EDA or Residual plots for the whole model and the end model. For instance, in EDA, the histogram of the response variable may be used to test the assumption of normality. The scatter plot may be used to determine the degree of nonlinearity between variables and the possibility of multicollinearity. Residual plots are the most often used method for assessing noncompliance. Any patterns in the residual plot may indicate that an assumption in this model has been violated. If the assumptions of non-constant variance, non-linearity, and non-normality are violated, we may apply the transformation technique to resolve these issues.

## Result

We can find that the train and test dataset have the similar distribution so that we can validate our final model by the test dataset. The pairwise scatter plots are shown in Figure 1, and no apparent nonlinear trend between score and other predictors appears in the figures. There is no very high correlation between covariates for these predictors, so there is no obvious multicollinearity problem. 

```{r train_setup, include = FALSE}
rent = train
summary(rent)
table(rent$PROPERTY_TYPE)
table(rent$PROPERTY_TYPE)/length(rent$PROPERTY_TYPE)

sd(rent$YEAR_BUILT)
sd(rent$YEAR_EVALUATED)
sd(rent$CONFIRMED_STOREYS)
sd(rent$CONFIRMED_UNITS)
sd(rent$SCORE)
sd(rent$NO_OF_AREAS_EVALUATED)
sd(rent$Age_Evaluated)
sd(rent$LATITUDE)
sd(rent$LONGITUDE)
```



```{r train_num,  fig.width=8, fig.height=8,fig.cap="Scatter plot for the train dataset",echo = FALSE}
train_num = train%>%dplyr::select(SCORE,CONFIRMED_STOREYS,CONFIRMED_UNITS,NO_OF_AREAS_EVALUATED, LATITUDE,LONGITUDE,Age_Evaluated)
plot(train_num)
```



Firstly, I run the full regrssion model and the results are shown in the first column of Table 2. The variance inflation factor (VIF) are all less than 5, so no multicolinearity occurs. The LATITUDE is not significant and there are 7 predictors in the model, so I choose automated selection method by AIC and BIC measures, and the results are shown in column 2 and 3. The AIC model is the same as the full model, while the BIC model drops confirmed storeys, confirmed units and Latitude. The $R^2$ of BIC model is 0.078, only 0.2% smaller than the full model, and it has the smallest BIC measure. So I select the BIC model as my final model in the end. 


```{r full_model, include=FALSE}
full_model = lm(SCORE~Age_Evaluated+CONFIRMED_STOREYS+CONFIRMED_UNITS+NO_OF_AREAS_EVALUATED+as.factor(PROPERTY_TYPE)+ LATITUDE+LONGITUDE,data = train )
AIC_model = step(full_model)
n = nrow(train)
BIC_model = step(full_model,k = log(n))
```


```{r test_BIC, include=FALSE}
Test_BIC_model = lm(SCORE ~ Age_Evaluated + NO_OF_AREAS_EVALUATED + as.factor(PROPERTY_TYPE) + LONGITUDE, data = test)
```


```{r huxtable, include=FALSE}
huxtable::huxreg(full_model,AIC_model,BIC_model,Test_BIC_model)
```

```{r vic_full_model, include=FALSE}
library(regclass)
VIF(full_model)
```


From Figure 1, the additional conditions have been satisfied. The residual plots for BIC model are shown in Figure2. The top-left figure shows that linearity and constant variance assumption are satisfied. The normal Q-Q plot shows the normality assumption is also hold. Then, the bottom two figures show that no obvious outliers and influential points, but there are several leverage points. In all, all the assumptions are good, so we don't need to do further transformation. 

I validate the final model by the test dataset, and the results are shown in the last column of Table 2. The estimated coefficients between test dataset and train dataset have the similar sign and significance. But, we still find some difference, for example, the R2 of final model in train dataset is 7.8%, while the one in test dataset is 10.4%. The p-value of the coefficeint of age is less than 0.001, while it is between 0.01 and 0.05 in the test dataset. 


```{r bic_plot,  fig.width=6, fig.height=6,fig.cap="Residual plots",echo = FALSE}
par(mfrow = c(2,2))
plot(BIC_model)
```

From the previous analysis, we found that the safety score is related to the age, number of area evaluated, and their location. If one more age of the apartment, about 0.03 score decreases holding other variable constant. The (Toronto Community Hosing)TCHC building has the worst safety score than social housing and private housing, about 5 scores less than other types. However, the R-square is only 8%, this model can only explain 8% variation of the safety score. 


# Discussion
# Discussion


## Bias and Ethical Concerns

As this data is based on people and their personal experiences with a very sensitive topic, there are likely to be some ethical implications that could limit the true accuracy of our data. 

A problem with the original data source is that there are only two genders listed, male and female. However there are many different gender identities internationally, which shows the problem that even if this is supposed to be a dataset for a global issue, the way that the data was collected was still eurocentric. These different gender identities could also come with their mental challenges and experiences that hinder their decision to seek help. As these different gender identities and their experiences are not included in the original survey, it hinders the accuracy of the main points that the Wellcome Trust intended to make. Gender non-conforming people are often ridiculed, looked down and not allowed to progress in their society due to the effects of colonialism [@Hussain2019], in such a way that they were not included in a survey specifically intended for mental health treatment. The dataset also did not include an 'other' option to account for the diversity in gender identities. Even if they did, that groups a lot of different gender identities together; genders that are completely different from each other. 

The dataset only collected data on anxiety and depression and how they affect a respondent's worldview. They did not include different common but also debilitating mental disorders such as Bipolar Disorder, ADHD and others. Not including these disorders when conducting the survey promotes the further exclusion of people with these illnesses from developing treatment, and also hinders their ability to seek treatment even as these disorders are also common. It also perpetuates the myth that depression and anxiety are the only two valid illnesses as they are the ones that appear in popular media the most with the most sympathy, while other mental disorders that affect the lives of millions worldwide are type cast as evil and dangerous. 

There are problem on how to measure depression and anxiety, as not all expressions of these illnesses are the same, and different cultures may express them in different ways. As the ways that respondents understood these concepts were very broad, creating a standardized way as stated in the methodology section [@citegallup] is too restrictive and also has the possibility of following eurocentric standards of mental illness. Thus, the dataset may not be getting the full picture of the manners that people relate to mental disorders in their daily life and their perceptions of these illnesses.  

The survey collected information on people only 15 years and older, but the mental health for children is also important. Children below the age of 15 make up 26% of the global population, and are also prone to disorders such as depression and anxiety. Child psychology deals with the importance of mental heath treatment for children and how traumatic experiences from childhood can affect adulthood, but such vital information is missing from the dataset. This helps perpetuates the difficulty of child psychology to be taken into account when dealing with multi-national health.  Children are also less likely to seek mental health care due to parental situations that were mentioned in the report, and this could have brought up important conversations on when children need to start making their own medical decisions and the advantages or disadvantages [@Fundudis2003] As their experiences were not part of the survey, the results are likely inaccurate as a true measure of global perceptions and reactions to mental health and mental health care. 

Finally, the dataset does not explain why lower income and unemployed people are less likely to seek mental health care to their richer counterparts. This would then lead those analyzing the data to believe that it is correlated to their level of education; that they are not self-aware enough to know that they have a problem. This is often not the case as low income people are often fully aware of the problems they have and the need to treat it, but simply do not have the funds or the availability to utilize mental health resources.


## Data Collection Concerns 

There were some countries in which no data was recorded. This could be due to either these people not being randomly chosen due to a small population, or no-one that was chosen in the country decided to participate in the survey. Many of these missing countries were from Africa, and this missing data from these countries introduced bias in the dataset as these countries make a significant portion of the total global population. The results presented are thus likely very different from the true global perceptions of mental health and care,and is likely biased towards the western world and South America as most countries in those areas were included.  

Some countries' mental health data were collected in a non-representative way. This was due to all respondents being from just one city in the country, for example all respondents from Congo lived in Brazzaville. The data for these countries are thus not randomly sampled, and doesn't contain the true overall perspective as the views of city people are likely different from those in smaller towns or rural areas. 

The survey could have other sampling biases. The people being randomly sampled for each country may have a more pro-mental care or anti-mental care stance, and the politics of the people could also influence their stance. Since the survey could be sampling a large proportion of people for either stance, the results for that country could be biased.

The survey put "Don't Know" and "refused to answer" in the same option. This causes problems as the people who truly do not know could actually have an opinion or answer, but due to not understanding the question due to the strict interpretation of questions, were confused. "Don't know" is also not related to "Refused to answer", as not knowing is an opinion in itself and could be used for analysis, however grouping them in with those who refused to answer at all makes these results harder to interpret.

There is also the possibility that people submitted fake answers. Although this is less likely over the phone (the way the survey was conducted) than over the internet, it still poses a problem. Filtering out this data is thus difficult as there is no indicator of which information is real and which is fake. 

## Impact of Age and Mental Health Access

(Figure \@ref(fig:figseven)) revealed that the older one is, the higher the probability that they seek mental health care, gender notwithstanding. There are several mental health stresses related to age, such as a decline in capabilities and functional ability. As these are less likely to happen to younger people, they are less likely to seek therapy because of it. Older people may also feel as they are getting older they are more of a burden to society and less functional, due to ageism. This may also induce age related problems such as depression over loss of function and anxiety over being replaced [@Dollinger2001]. For middle aged adults, the stress of work may also contribute to these mental health problems and the decision to seek help, which young adults do not relate to as they are in college or just starting their careers. This could also be associated with the mid life crisis common in men around 40, an attempt to hang onto youth. This can affect the decision to finally seek help over the anxiety of aging and their new positions in life. In addition, older people are more likely to experience events such as bereavement, or a drop in socioeconomic status with retirement. All of these stresses can result in isolation, loneliness or psychological distress in older people, for which they may seek mental health care [@whold]. As younger people still do not have as many societal pressures on them as older adults, or are not as knowledgeable on the existence of mental health and treatment compared to those with more life experience, they are less likely to seek help. Mental health problems are under-identified by health-care professionals and younger people themselves, and the stigma surrounding these conditions makes younger adults reluctant to seek help [@Corrigan2014]. Older adults are also more likely to have a larger income than young people, making them more likely to be able to afford treatment compared to young adults who don't have accumulation of funds from decades of being in the workforce. This means that young adults who suffer from these disorders are less likely to seek the help they need.

## Impact of Gender on Mental Health Access

Gender is one of the critical determinants of mental health expression and the decision to seek mental health care. Many studies such as [@Pattyn2015] have shown that women, irrespective of segmentation in other groups such as age, employment status, etc. are consistently more likely to seek mental help than men are. This is not due to a lack of need of mental help from men, but mainly due to different patriarchal societal expectations of men and women, which restricts the emotional vulnerability that men are allowed to express in society. Men and women think and act as they do due to  cultural ideas of femininity and masculinity, not because of role identities or psychological qualities [@Mackenzie2006]. People have preconceived biases about what behavior is acceptable for men and women and establish these gender difference during social encounters.  Many studies in the United States showed that women reported higher degrees of distress than males, and they were more likely to perceive having an emotional disorder than men with similar levels of symptoms [@soveny]. Emotional expression, health care, and asking for help are all framed as feminine traits. Men are expected to be  emotionally stable and be strong, self-reliant, and independent. On the contrary, women are expected to show their emotions, be frail, and rely on others. Thus, men separate themselves from women by hiding their own health needs and refusing to seek care to conform to the standard male roles. These happens worldwide in some form, irrespective of the specific ideas of masculinity, or how socially progressive the country is. Men may be hesitant to seek professional help because of this conflict in gender roles, and the fear of increased stigma and "demasculinaztion" if they decide to seek help. Men are thus more likely than women to deal with mental illness on their own when it comes to treatment, or delay getting treatment to the point that avoiding the problem becomes impossible. If they do seek professional help, they prefer quick solutions, which is why they are more likely to seek medical treatment more than therapy [@Pattyn2015]. Therapy also involves being emotionally vulnerable to another person, which is also discouraged in the strict standards for masculinity. These standards start young, as boys are more likely to be discouraged from crying or showing emotions when they are sad; the general "be a man" concept, as opposed to young girls where similar actions are encouraged [@Vogel2011]. Male socialization discourages these behaviors as being weak or womanly,which leads these boys as they get older to conceal their emotion to the point of not knowing if there is a problem within. This also leads to the much higher suicide rates for men as they do not seek help to the extent that women do.  


## Impact of Income and Employment on Mental Health Access 

Professional mental health care is expensive and unattainable for many as the cost of a single session can cost over a hundred US dollars, and in many cases several therapy sessions are needed over a long period of time. This makes mental health care inaccessible for many people worldwide who have neither the time nor the money to undergo the full extent of treatment. This increases the barriers that low income people who often work demanding jobs have to go throught o get the help that they need. 

The report, specifically (Table \@ref(fig:tabtwo)) and other literature shows that lower income people do not have the ability to seek mental health care as much as higher income people do. Low income people spend their money instead on the necessities, and as lower income people are also more likely to be lower educated, they either are not aware that the problems they have are due to a mental disorder, or do not see mental health care as an important cost to bear [@Hodgkinson2017]. Poverty itself has a negative effect on mental health, with the stress and anxiety of not being able to afford bare necessities or partake in recreational activities which cost money, as well as raising children on a low budget and the stigma of being poor that exists globally. Still, there is a vast unmet need for mental health services in this population. It is estimated that among people experiencing poverty in the US who are in need of mental health care, less than 15 percent receive mental health care, and even fewer complete treatment [@Hodgkinson2017]. People living in poverty also face non-financial barriers that reduce their ability to access mental health services. Families in rural areas, for example, often have to travel long distances to access mental health services. A lack of insurance and state funded health care can also prevent lower income people from accessing the help that they need. Mental health clinic hours are also often during the day and do not accommodate for low income people working in low wage jobs, who often do not have the flexibility to consistently attend therapy [@Hodgkinson2017]. The effects of these barriers are increased by the stress and demand of living in poverty. [@Hodgkinson2017] adds that some mental health professionals need to confront their failures on addressing the needs of lower income people, including a lack of training for practice in the context of poverty, facing their own personal biases and beliefs, stigma associated with working with families from low-income communities, and difficulties applying the standard diagnostic framework with people struggling to get by. This also influences why some low income people do not trust the health care system, and by association, the mental health care system. This also causes a negative feedback loop in which poor metal health makes unemployment much more likely and also increases the length of unemployment [@unemployed], which then affects their ability to earn an income, which makes it harder to seek mental health care [@Drake2020]. This is a  cycle that keeps poor people from accessing help to treat their problems and further perpetuates their stigmatization in society as being both low income and mentally ill. 

Even higher income people who are employed do not seek mental health services because they likely see the stress and anxiety they face in work as normal factor of their highly stressful jobs. Places where the employed are overworked will often make them believe that this is an inherent characteristic of the work environment. Those who are employed but underpaid, or are part time employed but want full employment also have issues similar to the unemployed and low income people.  Self employment also has no positive mental benefit for men and a negagive benefit for women, and they are also less likely to seek help as seeking treatment for mental disorders is not a priority as they do not have free time [@Parslow2004]. However, high income people are more likely to have stability, can afford therapy and can afford to seek better options if things go wrong. This is counterintuitive as those who are unemployed or underemployed often suffer from anxiety/depression, which they cannot afford to treat [@Drake2020]. 


## National Differences

The average probability of seeking mental health care varies by country and continent, as shown by (Figure \@ref(fig:figeight)).  We see that overall Europe had a higher average probability of seeking mental health care, Africa had a lower probability average, and the average probability for Asia was in the middle. The countries that had a lower probability of seeking mental health care are often lower income countries, which translates to less funding for mental health facilities, as well as more isolated rural areas where these facilities and knowledge on mental health in general, are scarce. In these countries there are also less amount of trained professionals in mental health psychology, and those who are trained often often migrate to higher income countries, contributing to brain drain and a worsening mental health care network [@Saraceno2007]. Mental health is also not seen as a priority in many low income countries, with many countries having mental heath services being less than 1 percent of the total health budget [@Patel2007]. In these counties there is also a distrust for the usually western based mental health care, seeing it as foreign and preferring to seek more traditional avenues for mental health problems, usually religion based [@Weatherhead2010]. Less progressive beliefs and attitudes towards mental health also are more prevalent in these nations.  In these countries, especially the poorest income countries, mental health treatment is less of a necessity compared to acquiring treatment for physical ailments which can hinder physical work, and what is needed for survival.  People in these countries with visible problems are also often labeled as just being possessed or crazy, without inspection of the underlying problems. Thus locally available, affordable mental health treatment options are not an option  for these countries[@Patel2007]. This is especially true for countries in Africa and the middle east which are currently undergoing war. This leads to a major drain of professionals and destruction of facilities. 

In contrast, wealthier and more developed nations have a well endowed, developed network of mental health professionals, and the care is either free or heavily subsidized. The facilities are easily available and the public is more educated on mental disorders, how they can be treated, and the importance of treatment. However, this is not true for all first world nations, as industrialized East Asian countries still have a bias against victims of mental disorders [@Roh2016], which lead to their stigmatization in society. Mentally ill people are often seen as weak or the cause of their own problems. This indicates that culture and education, not just wealth of a nation, affects the choice to seek mental health care. 

Colonialism also affects these actions as some mental health stigmas or situations that can cause mental health disorders seen in some countries  did not exist before the age of imperialism. This includes the stress and anxiety that comes LGBT people have due to oppression from countries not known to be historically homophobic[@Dagsvold2015]. More rigid gender binaries were introduced by colonialism, which did not exist in some more gender-egalitarian precolonial societies, thus enforcing the gender gap in mental health care seen today. The introduction of religion, primarily Christianity and Islam, also affects the decision by people in colonized nations to seek help in preference of religion.  



## Views of Mental Health and Mental Health Care in Society 

The report has shown that there is still a long way to go for mental health to be seen as important as physical health care. Despite mental problems being nearly as common as physical problems, there are several social, cultural, financial, systemic, and personal stigmas that leads people to choose not to seek care. All of these need to be addressed to see real change in awareness of mental health care and other resources. 

In many societies there is still a lot of misconceptions on what constitutes mental disorders and illnesses, and how to treat them. Views on mental disorders are heavily affected by religion, in which some relegate these problems to spirits or other supernatural entities [@Amin], while other beliefs see them as a punishment [@Zolezzi2018], while in others, people with mental problems are seen as religious leaders. The decision to seek mental health care is also influenced by religion, as some religions see them as fake science and to seek religious authority instead. 

Negative views towards mental health care in the west may also be influenced by treatment of mental health patients in wards and asylums, both in the past and in the present. In the past, the main purpose of these mental institutions were not to truly help the patients, but to lock them away from society, and hide the abuse that these patients went under from staff. There are also fears that mental health institutions will separate people from society, i.e institutionalize them, if they reveal too much to therapists [@Richman1982]. Mental disorders with less obvious symptoms are often overlooked or misdiagnosed.

Mental health care has also had a negative history with racial and ethnic minorities worldwide, that paints a negative view of the system in the modern day. legitimate mental problems that occurred in these minorities were discarded due to their minority status, or worse treatment due this status, leading to modern day distrust of the system [@Dagsvold2015]. Racial and ethnic minorities are also less likely to have access to adequate care, leaving them with less than stellar treatment, which negatively affects their view on all forms of treatment [@race].

A popular view on mental health is that any mental problems a person may face is from their own shortcomings and within their control [@notbad]. Many do not understand the medical reasons behind mental disorders, and see mental symptoms as a form of failure of personal responsibility. The more negative symptoms of some mental disorders such as violent outbursts or poor hygiene also paint a negative light on the mentally ill as bad people rather than as sufferers of debilitating disorders [@Corrigan2014]. This makes it hard to not only talk about these problems with others, but also to seek help, as they have a sense of guilt over their own health.

Those who seek help from friends are also likely to seek help from professionals, as they have the support system and confidence to be vulnerable with others on a sensitive topic [@Mojtabai2007]. People with mental health problems are less likely to find work, be in steady relationships, live in decent housing, and be socially included in mainstream society. This is due to institutional biases such as having less faith in the mentally ill compared to the mentally stable. This manifests in ways such as landlords not believing that those with disorders can hold a house, or employers seeing them as unpredictable and unstable.  This shows why those with less obvious symptoms choose not to come out and seek help [@Corrigan2014]. Mental health is demonized through stereotypes that perpetuate preconceived negative notions about mental ill health, such as violence and laziness. Media in many countries often link mental illnesses with violence or portray victims as dangerous or criminal, or unable to live normal lives. 

# Weaknesses and Next Steps 

During data cleaning, we removed all observations that had a missing value in the response variable; the choice to seek mental health care. This removed a lot of observations from the model, even removing all the observations of one country. If these observations were not dropped randomly from the dataset, there is bias and we are not getting the true results. All observations which included "Not Sure" were changed to a "No" in our dataset. As the true beliefs of a person who put "not sure" could have actually been a yes if they understood the question, or a "not sure" was their genuine answer, putting a no introduces bias in the model. The predictive effect of our model was quite weak, only getting 65.4% of total observations correct. This may indicate that our model did not have the best variables possible to explain the choice to seek mental health care. Also as our model has a binary output, we are not able to account for not just the decision to seek care, but how many sessions of therapy were attained. We are generalizing that everyone who sought help at least once sought it multiple times, which is often not the case. Finally, a lot of our variables in model assumptions were very dependent on each other, meaning that this multicollinearity could have caused less precise estimates of our coefficients. 

For further reports, the dataset does not state whether a person chooses not to seek help because they do not want help, or because they are not able to seek help, or both. Dividing these decisions into two variables could help with further analysis on the barriers to getting mental health treatment. We could also include other mental disorders and their effect on societal attitudes and decisions to seek help, as well as respondent experiences with these disorders. This will create a fuller idea of how mental disorders are viewed worldwide. we could also focus specifically on mental health in the COVID19 era, and how COVID19 and subsequent lockdowns changed attitudes towards mental health. We could use a linear mixed model to include a random effect of country in our model to account for the possibility that not all observations in the same country are truly independent from each other, as they may have similar shared experiences. We could also use other variables in our model related to attitudes on mental health to try and improve the predictive properties of the model.


# My discussion
There is also some weakness of the problem. For example, the sample size may not be large and representative enough for finding a true parameter. Also, it repeated only 1000 times so that the R cloud is not overloaded, but we can have a higher accuracy if we simulate more than 10000 times. In a further study, we might increase the sample size to get a more accurate and representative true parameter. Also, have a larger simulation could also increase the accuracy.


What is done in this this paper? What is something that we learn about the world? What is another thing that we learn about the world? What are some weaknesses of what was done? What is left to learn or how should we proceed in the future?


# Appedix


**Table 1: Summary results of test and train dataset**

|  | Train Dataset|Test Dataset|
|--------------- |--------------- | --------------- | 
|**Built Year** |
|Mean/SD| 1961/18.46|1961/18.37|
|**Evaluated Year** |
|Mean/SD| 2018/1.47 | 2018/1.45|
|**Evaluated Age** |
|Mean/SD| 57.6/18.5 |57.9/18.4 |
|**Storeys** |
|Mean/SD| 7.6/6.1 |7.4/6.0|
|**Units** |
|Mean/SD| 88/94 |86/93 |
|**No of Evaluated Areas** |
|Mean/SD| 17.2/1.66 |17.1/1.67 |
|**Evaluated Score** |
|Mean/SD| 71.2/10 | 72.2/10 |
|**LATITUDE** |
|Mean/SD| 43.7/0.04 | 43.7/0.04 |
|**LONGITUDE** |
|Mean/SD| -79.4/0.09 |-79.4/0.09 |
|**Property type** |
|Private| 4014(84%) |4004(84%) |
|Housing| 289(6%)| 293(6%)|
|TCHC| 455(10%) |461(10%) |
|**Sample size** |4758 |4758|

